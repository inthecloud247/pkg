# Maintainer: Angel Velasquez <angvp@archlinux.org>  
# Contributor: Vsevolod Balashov <vsevolod@balashov.name>
# Contributor: Kevin Zuber <uKev@knet.eu>
# Contributor: Eivind Uggedal <eivind@uggedal.com>
pkgname=uwsgi
pkgver=1.2.4
pkgrel=1
pkgdesc="a fast (pure C), self-healing, developer-friendly WSGI server"
arch=(i686 x86_64)
url="http://projects.unbit.it/$pkgname"
license=(GPL2)
depends=(python2 libxml2)
conflicts=(python-$pkgname)
makedepends=(gcc python2)
backup=(etc/conf.d/uwsgi etc/uwsgi/emperor.ini)
source=(http://projects.unbit.it/downloads/$pkgname-$pkgver.tar.gz
        uwsgi.rc
        emperor.ini
        uwsgi.conf
        buildconf.ini)
md5sums=('5216f3742fee40999ca4519519b890ad'
         'ea01765f6b29fe606b90ea7f3a9be9fa'
         '40d979a25dd87c11a18647c2197ab818'
         '6386ef54fbeb25824f61214f463a576f'
         '198397c5f45ca390acac5bb5b1a43c6b')

build() {
  cd $srcdir/$pkgname-$pkgver
  cp $srcdir/buildconf.ini buildconf/minimal.ini
  python2 uwsgiconfig.py --build minimal
}

package() {
  cd $srcdir/$pkgname-$pkgver
  mkdir -p $pkgdir/usr/bin
  install -Dm755 uwsgi $pkgdir/usr/bin/uwsgi
  mkdir -p $pkgdir/etc/rc.d
  install -Dm755 $srcdir/uwsgi.rc $pkgdir/etc/rc.d/uwsgi
  mkdir -p $pkgdir/etc/conf.d
  install -Dm644 $srcdir/uwsgi.conf $pkgdir/etc/conf.d/uwsgi
  mkdir -p $pkgdir/etc/uwsgi/vassals
  install -Dm644 $srcdir/emperor.ini $pkgdir/etc/uwsgi/emperor.ini

  mkdir -p $pkgdir/var/run/uwsgi
  mkdir -p $pkgdir/var/log/uwsgi
}
